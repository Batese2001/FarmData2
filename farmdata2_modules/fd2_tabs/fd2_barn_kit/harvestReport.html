<body>
    <h1>Harvest Report</h1>
    <br />
    <p>This page is a form for generating a harvest report</p>
    <br />
    <div id="harvRptVue" v-cloak>
        <label for="rptTitle">Title:</label>
        <input type="text" v-model="harvRptTitle" id="rptTitle" />

        <br /><br />

        <button class="btn btn-primary" @click="genHarvRpt">
            Generate Report
        </button>
        <div v-if="visible">
            <hr />
            <h1>
                {{ harvRptTitle == '' ? 'My Harvest Report' : harvRptTitle }}
            </h1>
            <br />
            <br />
            <ul>
                <li><strong>Start:</strong>{{}}</li>
                <li><strong>End:</strong> {{}}</li>
                <li><strong>Crop:</strong>{{}}</li>
            </ul>
            <br />
            <p v-if="harvTable.length == 0">There are no matching records.</p>
            <table border="1" v-else>
                <tr>
                    <th v-for="header in harvHeaders">{{ header }}</th>
                </tr>
                <tr v-for="(harvLog, index) in harvTable">
                    <td>{{ harvLog.date }}</td>
                    <td>{{ harvLog.field }}</td>
                    <td>{{ harvLog.crop }}</td>
                    <td>{{ harvLog.yield }}</td>
                    <td>
                        <button type="button" @click="deleteHarvLog(index)">
                            Delete
                        </button>
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <script>
        var harvRptVue = new Vue({
            el: '#harvRptVue',
            data: {
                rptPath: '/log.json?type=farm_harvest', //change this and add path creator method when filters are added!
                harvRptTitle: 'My Harvest Report',
                visible: false,
                harvHeaders: ['Date', 'Field', 'Crop', 'Yield', 'Delete'],
                harvLog: [],
                harvTable: [],
            },
            methods: {
                genHarvRpt: function () {
                    axios.get(this.rptPath).then((response) => {
                        this.harvLog = response.data.list.map((entry) => {
                            return {
                                date: entry.timestamp, //make human readable
                                field: entry.area[0].name,
                                crop: entry.name.split(' ')[
                                    entry.name.split(' ').length - 1
                                ],
                                yield:
                                    entry.quantity[0].value +
                                    ' ' +
                                    entry.quantity[0].unit.name,
                            };
                        });
                    });
                    if (this.harvTable.length < 10 //change 10 to this.harvLog.length when filters are added! 
                    && this.visible) {
                        this.harvTable.push(this.harvLog[this.harvTable.length]);
                    }
                    this.visible = true;
                },
                deleteHarvLog: function (nameIndex) {
                    this.harvTable.splice(nameIndex, 1);
                },
            },
        });
        Vue.config.devtools = true;
    </script>
</body>
